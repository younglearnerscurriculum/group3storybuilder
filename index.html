<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>âœ¨ YLC Story Generator âœ¨</title>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right,#7C1948,#BB96F6);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      border: 4px solid #7C1948;
      border-radius: 18px;
      width: 95vw; max-width: 1280px;
      aspect-ratio: 16/9;
      padding: 15px;
      display: flex; flex-direction: column;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      overflow: hidden;
    }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; }
    header h1 { color: #7C1948; font-size: 1.8em; margin: 0; }
    header .team-info, header .date { font-size: 1em; color: #333; font-weight: bold; }

    .directions { text-align: center; font-size: 1.1em; margin-bottom: 10px; }
    #timer { text-align: center; font-weight: bold; font-size: 1.2em; color: #7C1948; margin-bottom: 8px; }

    .roles { display: flex; gap: 12px; justify-content: center; margin-bottom: 10px; flex-wrap: wrap; }
    .roles label { display: flex; align-items: center; gap: 6px; background: #f7f3fc; padding: 6px; border-radius: 8px; }
    .roles select, .roles input { padding: 6px 8px; border-radius: 6px; border: 1px solid #999; font-size: 1em; }

    .level-select { text-align: center; margin: 8px 0; }
    .level-select button { margin: 0 6px; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 1em; }
    .easy { background: #a8e6cf; }
    .normal { background: #ffd93b; }
    .challenge { background: #ff6f61; color: #fff; }

    .page { flex: 1; display: none; flex-direction: column; }
    #page1 { display: flex; flex-direction: column; align-items: center; gap: 10px; }

    #madlib-area { margin: 10px auto; display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 8px; max-width: 800px; }
    #madlib-area input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; text-align: center; }

    #story-box,#story-box-final,#story-editor {
      border: 2px solid #7C1948;
      border-radius: 10px;
      padding: 10px;
      background: #fff;
      overflow-y: auto;
      flex: 1;
    }
    #story-editor { resize: none; font-family: inherit; margin-top: 8px; min-height: 120px; }

    .button-row { text-align: center; margin-top: 10px; }
    .button-row button { margin: 0 5px; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }

    .workspace { flex: 1; display: flex; gap: 12px; }
    .workspace > div { flex: 1; display: flex; flex-direction: column; }

    #draw-canvas {
      border: 2px solid #7C1948;
      border-radius: 10px;
      background: #fff;
      flex: 1; width: 100%; height: 100%;
      touch-action: none;
    }
    .canvas-controls { margin-top: 8px; text-align: center; }

    footer { text-align: center; font-size: .9em; margin-top: 6px; color: #333; }

    .vocab-list { text-align: center; margin: 10px 0; }
    .vocab-list span { margin: 0 6px; padding: 4px 8px; border: 1px solid #7C1948; border-radius: 6px; cursor: pointer; display: inline-block; }
    .vocab-list span.used { text-decoration: line-through; opacity: 0.6; }

    #trophy { display: none; font-size: 1.5em; color: red; margin-top: 6px; }
    #reminder-banner { display:none; background:#ffd93b; padding:10px; text-align:center; font-size:1.2em; }
    .confirm, .submit { text-align: center; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="team-info">Team: <span id="team-names">(Enter roles below)</span></div>
      <h1>âœ¨ YLC Story Generator âœ¨</h1>
      <div class="date" id="date">ğŸ“… Loading date...</div>
    </header>

    <div id="timer">â³ 15:00</div>
    <div class="directions">Step 1: Assign roles â†’ Step 2: Generate â†’ Step 3: Edit & Draw â†’ Step 4: Verify & Submit ğŸ“¸</div>

    <!-- Roles -->
    <div class="roles">
      <label>Role 1:
        <select id="role1">
          <option>âœï¸ Writer</option>
          <option>ğŸ¨ Illustrator</option>
          <option>ğŸ¤ Reporter</option>
        </select>
        <input id="role1-name" placeholder="Name">
      </label>
      <label>Role 2:
        <select id="role2">
          <option>âœï¸ Writer</option>
          <option>ğŸ¨ Illustrator</option>
          <option>ğŸ¤ Reporter</option>
        </select>
        <input id="role2-name" placeholder="Name">
      </label>
      <label>Role 3 (optional):
        <select id="role3">
          <option>âœï¸ Writer</option>
          <option>ğŸ¨ Illustrator</option>
          <option>ğŸ¤ Reporter</option>
        </select>
        <input id="role3-name" placeholder="Name">
      </label>
      <button onclick="saveTeam()">âœ”ï¸ Save Team</button>
    </div>

    <!-- Level Select -->
    <div class="level-select" id="level-section">
      <button class="easy" onclick="showMadlib('easy')">ğŸŸ¢ Level 1 (A1â€“A2)</button>
      <button class="normal" onclick="showMadlib('normal')">ğŸŸ¡ Level 2 (A2â€“B1)</button>
      <button class="challenge" onclick="showMadlib('challenge')">ğŸ”´ Level 3 (B2â€“C1)</button>
    </div>

    <div id="madlib-area"></div>

    <!-- Page 1 -->
    <div id="page1" class="page">
      <div id="story-box">Your generated draft will appear here.</div>
      <div class="button-row">
        <button onclick="generateStory(currentLevel)">âœ¨ Generate Draft</button>
        <button onclick="regenerateStory()">ğŸ”„ Regenerate Draft</button>
        <button onclick="goToPage2()">â¡ï¸ Continue to Edit & Draw</button>
      </div>
    </div>

    <!-- Page 2 -->
    <div id="page2" class="page">
      <div id="reminder-banner">âš ï¸ Time is almost up! Please finish, screenshot, and send to your teacher.</div>

      <div class="vocab-list" id="vocab-list"></div>
      <div id="extra-help" style="text-align:center; font-size:0.9em; margin-bottom:10px; color:#444;"></div>
      <div id="progress" style="text-align:center; font-size:0.9em; margin-bottom:10px; color:red;"></div>

      <div class="workspace">
        <div>
          <h3>âœï¸ Writer</h3>
          <small id="writer-req"></small>
          <div id="story-box-final">Your story will appear here...</div>
          <textarea id="story-editor" placeholder="Edit your story here..."></textarea>
        </div>
        <div>
          <h3>ğŸ¨ Illustrator</h3>
          <small>Draw below (finger/stylus on tablet) or write a description.</small>
          <canvas id="draw-canvas"></canvas>
          <div class="canvas-controls"><button onclick="clearCanvas()">ğŸ§¹ Clear</button></div>
        </div>
      </div>

      <div id="trophy">ğŸ† Great job! You reached the requirement!</div>

      <div class="confirm">
        <label><input type="checkbox" id="verify-check" onchange="toggleContinue()"> âœ… We verify this story is our own work</label>
      </div>
      <div class="submit">
        <button id="continue-btn" onclick="submitWork()" disabled>âœ… Continue / Submit</button>
      </div>
    </div>

    <footer>All rights reserved Â© Young Learners Curriculum 2025</footer>
  </div>

  <script>
    // === DATE ===
    document.getElementById('date').textContent =
      "ğŸ“… " + new Date().toLocaleDateString('en-US',{month:'long',day:'numeric'});

    // === TIMER ===
    let countdown;
    function startTimer(duration=900){
      let timeLeft=duration;
      const timerDisplay=document.getElementById('timer');
      clearInterval(countdown);
      countdown=setInterval(()=>{
        const m=Math.floor(timeLeft/60);
        const s=timeLeft%60;
        timerDisplay.textContent=`â³ ${m}:${s<10?'0':''}${s}`;
        if(timeLeft===60){document.getElementById('reminder-banner').style.display='block';}
        if(timeLeft<=0){
          clearInterval(countdown);
          timerDisplay.textContent="â° Time's up!";
          timerDisplay.style.color="red";
          document.querySelectorAll('button').forEach(btn=>btn.disabled=true);
        }
        timeLeft--;
      },1000);
    }

    // === SAVE TEAM ===
    function saveTeam(){
      const r1=document.getElementById('role1').value+": "+document.getElementById('role1-name').value;
      const r2=document.getElementById('role2').value+": "+document.getElementById('role2-name').value;
      const r3=document.getElementById('role3-name').value?document.getElementById('role3').value+": "+document.getElementById('role3-name').value:"";
      document.getElementById('team-names').textContent=[r1,r2,r3].filter(Boolean).join(" | ");
    }

    // === MADLIB INPUTS ===
    const madlibs={
      easy:`<input id="name" placeholder="Name (Alex)">
            <input id="place" placeholder="Place (park)">
            <input id="object" placeholder="Object (kite)">
            <input id="feeling" placeholder="Feeling (happy)">`,
      normal:`<input id="name" placeholder="Name (Alex)">
              <input id="friend" placeholder="Friend (Mia)">
              <input id="place" placeholder="Place (beach)">
              <input id="object" placeholder="Object (book)">
              <input id="activity" placeholder="Activity (playing)">
              <input id="problem" placeholder="Problem (storm)">
              <input id="solution" placeholder="Solution (ask for help)">
              <input id="emotion" placeholder="Emotion (excited)">
              <input id="ending" placeholder="Ending (they laughed)">`,
      challenge:`<input id="name" placeholder="Name (Alex)">
                <input id="friend" placeholder="Friend (Mia)">
                <input id="place" placeholder="Place (castle)">
                <input id="object" placeholder="Object (key)">
                <input id="activity" placeholder="Activity (exploring)">
                <input id="problem" placeholder="Problem (strange noise)">
                <input id="solution" placeholder="Solution (work together)">
                <input id="dialogue" placeholder='Dialogue ("We can do this!")'>
                <input id="sensory" placeholder="Sensory detail (cold wind)">
                <input id="emotion" placeholder="Emotion (brave)">
                <input id="ending" placeholder="Ending (they escaped)">`
    };

    let currentTemplate=null,currentLevel=null;
    function showMadlib(level){
      currentLevel=level;
      document.getElementById('madlib-area').innerHTML=`<div>${madlibs[level]}</div>`;
      document.getElementById('page1').style.display='flex';
      document.getElementById('page2').style.display='none';
      startTimer(); // start 15 min when level chosen
    }

    {
  "easy": [
    "[name] went to the [place]. They had a [object]. They used it. They felt [feeling].",
    "[name] walked to the [place]. They carried a [object]. They played with it. They were [feeling].",
    "At the [place], [name] found a [object]. They picked it up. They looked at it. They felt [feeling].",
    "[name] had a [object]. They brought it to the [place]. They used it there. They felt [feeling].",
    "[name] entered the [place]. They found a [object]. They played happily. They were [feeling].",
    "[name] carried a [object] into the [place]. They looked around. They played with it. They were [feeling].",
    "In the [place], [name] held a [object]. They showed it to a friend. They smiled. They were [feeling].",
    "[name] took a [object] to the [place]. They shared it with friends. They laughed. They felt [feeling].",
    "[name] walked through the [place]. They found a [object]. They played with it. They were [feeling].",
    "[name] and friends went to the [place]. They brought a [object]. They used it together. They felt [feeling]."
  ],

  "normal": [
    "[name] and [friend] went to the [place]. They carried a [object]. They wanted to [activity]. Suddenly, [problem]. They [solution]. They felt [emotion]. Finally, they [ending].",
    "At the [place], [name] showed [friend] a [object]. They tried to [activity]. Soon, [problem]. They worked to [solution]. They felt [emotion]. At last, they [ending].",
    "[friend] met [name] at the [place]. They had a [object]. They began to [activity]. Then [problem]. They [solution]. They were [emotion]. Finally, they [ending].",
    "[name] and [friend] carried a [object] into the [place]. They wanted to [activity]. But [problem]. They [solution]. They felt [emotion]. Finally, they [ending].",
    "[name] brought a [object] to the [place]. [friend] joined them. They started to [activity]. But [problem]. They quickly [solution]. They were [emotion]. Finally, they [ending].",
    "[name] and [friend] went to the [place] to [activity]. They had a [object]. But then, [problem]. They [solution]. They felt [emotion]. In the end, they [ending].",
    "One day, [name] and [friend] visited the [place]. They carried a [object]. They wanted to [activity]. But [problem]. They worked to [solution]. They were [emotion]. Finally, they [ending].",
    "At the [place], [friend] gave [name] a [object]. They wanted to [activity]. Suddenly, [problem]. They [solution]. They felt [emotion]. At the end, they [ending].",
    "[name] and [friend] went to the [place]. They carried a [object]. They planned to [activity]. But [problem]. They [solution]. They were [emotion]. Finally, they [ending].",
    "[friend] and [name] entered the [place]. They had a [object]. They tried to [activity]. Then [problem]. They [solution]. They felt [emotion]. At last, they [ending]."
  ],

  "challenge": [
    "[name] and [friend] entered the [place] with a [object]. They wanted to [activity]. The [sensory] was all around. Suddenly, [problem]. '[dialogue]' shouted [friend]. They [solution]. They felt [emotion]. Finally, they [ending].",
    "At the [place], [name] carried a [object]. [friend] said '[dialogue]'. They started to [activity]. Then [problem]. They [solution]. The [sensory] filled the air. They felt [emotion]. In the end, they [ending].",
    "[name] showed [friend] a [object] in the [place]. They planned to [activity]. Suddenly, [problem]. '[dialogue]' said [friend]. They [solution]. The [sensory] surrounded them. They felt [emotion]. Finally, they [ending].",
    "[friend] met [name] at the [place]. They had a [object]. They tried to [activity]. The [sensory] was everywhere. Suddenly, [problem]. '[dialogue]' said [name]. They [solution]. They felt [emotion]. Finally, they [ending].",
    "[name] and [friend] brought a [object] to the [place]. They wanted to [activity]. The [sensory] made it exciting. Suddenly, [problem]. '[dialogue]' shouted [friend]. They [solution]. They were [emotion]. At last, they [ending].",
    "One day, [name] and [friend] went to the [place]. They carried a [object]. They wanted to [activity]. But [problem]. '[dialogue]' called [name]. They [solution]. The [sensory] surrounded them. They were [emotion]. Finally, they [ending].",
    "At the [place], [name] held a [object]. '[dialogue]' said [friend]. They began to [activity]. Then [problem]. They [solution]. The [sensory] made it hard. They felt [emotion]. Finally, they [ending].",
    "[friend] and [name] entered the [place] with a [object]. They planned to [activity]. Suddenly, [problem]. '[dialogue]' said [friend]. They [solution]. The [sensory] was all around. They felt [emotion]. Finally, they [ending].",
    "[name] carried a [object] into the [place]. '[dialogue]' said [friend]. They wanted to [activity]. But [problem]. They [solution]. The [sensory] made it strange. They felt [emotion]. In the end, they [ending].",
    "At the [place], [friend] gave [name] a [object]. They started to [activity]. Suddenly, [problem]. '[dialogue]' was heard. They [solution]. The [sensory] filled the air. They were [emotion]. Finally, they [ending]."
  ]
}

    function generateStory(level){
      if(!level)return alert("Please select a level first!");
      const tlist=templates[level];
      currentTemplate=tlist[Math.floor(Math.random()*tlist.length)];
      const inputs={};
      document.querySelectorAll('#madlib-area input').forEach(inp=>{
        inputs[`[${inp.id}]`]=inp.value.trim()||inp.placeholder;
      });
      let story=currentTemplate;
      Object.keys(inputs).forEach(key=>story=story.split(key).join(inputs[key]));
      document.getElementById('story-box').textContent=story;
      document.getElementById('story-box-final').textContent=story;
      document.getElementById('story-editor').value=story;
      document.getElementById('level-section').style.display='none';
      document.getElementById('madlib-area').style.display='none';

      let reqMsg="";
      if(level==='easy')reqMsg="Use at least 3 words and write 4 sentences.";
      if(level==='normal')reqMsg="Use at least 4 words and write 5â€“7 sentences.";
      if(level==='challenge')reqMsg="Use all 6 words and write 8â€“10 sentences.";
      document.getElementById('writer-req').textContent=reqMsg;

      const vocab=['adventure','explore','problem','solution','teamwork','memory'];
      const vocabDiv=document.getElementById('vocab-list');
      vocabDiv.innerHTML=vocab.map(w=>`<span onclick="markWord(this)">${w}</span>`).join("");

      let helpMsg="";
      if(level==='easy')helpMsg="âœï¸ Try to use the words in simple sentences.";
      if(level==='normal')helpMsg="ğŸ“ Add adjectives and connectors (and, but, so) to make your story longer.";
      if(level==='challenge')helpMsg="ğŸ” Use descriptive language and complex sentences.";
      document.getElementById('extra-help').textContent=helpMsg;
      document.getElementById('progress').textContent="";
    }
    function regenerateStory(){ if(currentLevel) generateStory(currentLevel); }
    function goToPage2(){ document.getElementById('page1').style.display='none'; document.getElementById('page2').style.display='flex'; }
    function toggleContinue(){ document.getElementById('continue-btn').disabled=!document.getElementById('verify-check').checked; }
    function submitWork(){ alert("âœ… Work submitted! Thank you."); }

    // === TROPHY CHECK ===
    function markWord(el){ el.classList.add('used'); checkTrophy(); }
    function checkTrophy(){
      const used=document.querySelectorAll('#vocab-list span.used').length;
      const sentences=document.getElementById('story-editor').value.split(/[.!?]/).filter(s=>s.trim().length>0).length;
      let meets=false;
      if(currentLevel==='easy'&&used>=3&&sentences>=4)meets=true;
      if(currentLevel==='normal'&&used>=4&&sentences>=5)meets=true;
      if(currentLevel==='challenge'&&used>=6&&sentences>=8)meets=true;
      if(meets)document.getElementById('trophy').style.display='block';
      let neededWords=currentLevel==='easy'?3:(currentLevel==='normal'?4:6);
      let neededSentences=currentLevel==='easy'?4:(currentLevel==='normal'?5:8);
      const progressEl=document.getElementById('progress');
      progressEl.textContent=`Progress â†’ Words: ${used}/${neededWords}, Sentences: ${sentences}/${neededSentences}`;
      progressEl.style.color=meets?"green":"red";
    }
    document.getElementById('story-editor').addEventListener('input',checkTrophy);

    // === DRAWING CANVAS ===
    const canvas=document.getElementById('draw-canvas');
    const ctx=canvas.getContext('2d');
    let drawing=false;
    function resizeCanvas(){ canvas.width=canvas.offsetWidth; canvas.height=canvas.offsetHeight; }
    window.addEventListener('resize',resizeCanvas); resizeCanvas();
    function getX(e){ return e.touches?e.touches[0].clientX-canvas.getBoundingClientRect().left:e.clientX-canvas.getBoundingClientRect().left; }
    function getY(e){ return e.touches?e.touches[0].clientY-canvas.getBoundingClientRect().top:e.clientY-canvas.getBoundingClientRect().top; }
    function startDraw(e){ drawing=true; ctx.beginPath(); ctx.moveTo(getX(e),getY(e)); e.preventDefault(); }
    function draw(e){ if(!drawing)return; ctx.lineWidth=3; ctx.lineCap="round"; ctx.strokeStyle="#000"; ctx.lineTo(getX(e),getY(e)); ctx.stroke(); e.preventDefault(); }
    function stopDraw(){ drawing=false; ctx.closePath(); }
    canvas.addEventListener('mousedown',startDraw);
    canvas.addEventListener('mousemove',draw);
    canvas.addEventListener('mouseup',stopDraw);
    canvas.addEventListener('mouseout',stopDraw);
    canvas.addEventListener('touchstart',startDraw);
    canvas.addEventListener('touchmove',draw);
    canvas.addEventListener('touchend',stopDraw);
    function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }
  </script>
</body>
</html>
